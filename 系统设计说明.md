# 项目主体：

留言系统，页面展示类似弹幕滚动，下方有留言输入框，用户输入后会在页面中从右向左滚动播放。

# 云部署：

用户扫码打开二维码后访问的是一个 URL（例如 `https://example.com`），DNS（Route53）把该域名解析到 CloudFront。CloudFront 配置了两个 Origin：S3（静态资源）和 ALB（动态 API）。当请求路径为 `/`、`/assets/*` 等静态资源路径时，CloudFront 从 S3 拉取并返回静态网页文件（HTML/JS/CSS）；浏览器拿到静态文件后执行前端代码。
 当用户在页面里发送留言时，浏览器里的 JS 直接向同域名 API 路径（例如 `https://example.com/messages`）发起请求。CloudFront 根据 path routing（例如 `/messages`、`/delete`、`/stream`）将请求转发到 ALB，ALB 再把请求分发到后端 EC2（FastAPI）实例；后端接收到留言后将数据写入 DynamoDB，并将事件推送给 SSE 连接的客户端。
 因此：CloudFront+S3 负责快速稳定地提供前端页面，CloudFront+ALB+EC2 负责处理动态 API 请求并落库到 DynamoDB；前端通过同域名调用 API 完成业务闭环，从而避免跨域调用导致的 CORS 问题。

# 前端：

程序语言使用python，react+vite实现前端页面。通过nginx和fastapi实现前端和api调用，nginx实现同域名反代理坚决不出现CORS，fastapi配合SSE来刷新弹幕。轻量化鉴权通过页面加载时后端下发一个短期token，然后通过后端验证token过期与否，用以屏蔽API域名攻击。

# 后端：

后端采用 FastAPI + SSE 实现弹幕实时刷新，事件类型包括 `message` 和 `delete`；系统不实现断线补发与历史补偿机制。页面加载时后端下发有效期 5 分钟的短期 token，前端在请求头携带 `Authorization: Bearer <token>`，后端校验 token 是否存在与过期，用于屏蔽直接攻击 API 的请求。弹幕 id 为随机生成的 8 位不重复字母数字，用于入库与删除；当页面输入 `!delete <id>` 时触发删除逻辑。
 服务端将消息优先写入内存并进行 SSE 广播，同时将数据备份写入 DynamoDB；正常运行过程中不依赖 DynamoDB 读取，仅在实例重启时用于恢复内存状态。

后端具备轻度文本清理，不需设计去重和文本长度限制。